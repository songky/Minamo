(function($,undefined){$.Minamo=function(options,element){this.$ele=$(element);this._init(options)};$.Minamo.defaults={current:0,autoplay:false,interval:2000,margintop:'50px',showlength:1,xoffsetshow:'350',xoffsethide:'450'};$.Minamo.prototype={_init:function(options){this.options=$.extend(true,{},$.Minamo.defaults,options);this.support3d=Modernizr.csstransforms3d;this.support2d=Modernizr.csstransforms;this.supportTrans=Modernizr.csstransitions;this.$wrapper=this.$ele.find('.wr-wrapper');this.$items=this.$wrapper.children();this.itemsCount=this.$items.length;this.$nav=this.$ele.find('nav');this.$navPrev=this.$nav.find('.wr-prev');this.$navNext=this.$nav.find('.wr-next');this.$marginTop=this.options.margintop;this.$showLength=this.options.showlength;this.$XOffsetShow=this.options.xoffsetshow;this.$XOffsetHide=this.options.xoffsethide;if(this.itemsCount<3){this.$nav.remove();return false}this.current=this.options.current;this.isAnim=false;this.$items.css({'opacity':0,'visibility':'hidden'});this._validate();this._layout();this._loadEvents();if(this.options.autoplay){this._startSlideshow()}},_validate:function(){if(this.options.current<0||this.options.current>this.itemsCount-1){this.current=0}},_layout:function(){this._setItems();var leftCSS,rightCSS,currentCSS;if(this.support3d&&this.supportTrans){leftCSS={'-webkit-transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-200px)','-moz-transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-200px)','-o-transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-200px)','-ms-transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-200px)','transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-200px)','margin-top':this.$marginTop};rightCSS={'-webkit-transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','-moz-transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','-o-transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','-ms-transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','margin-top':this.$marginTop};leftCSS.opacity=1;leftCSS.visibility='visible';rightCSS.opacity=1;rightCSS.visibility='visible'}else if(this.support2d&&this.supportTrans){leftCSS={'-webkit-transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','-moz-transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','-o-transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','-ms-transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','margin-top':this.$marginTop};rightCSS={'-webkit-transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','-moz-transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','-o-transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','-ms-transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','margin-top':this.$marginTop};currentCSS={'z-index':999};leftCSS.opacity=1;leftCSS.visibility='visible';rightCSS.opacity=1;rightCSS.visibility='visible'}this.$leftItm.css(leftCSS||{});this.$rightItm.css(rightCSS||{});this.$currentItm.css(currentCSS||{}).css({'opacity':1,'visibility':'visible','-webkit-transform':'translateZ(-200px)','-moz-transform':'translateZ(-200px)','-o-transform':'translateZ(-200px)','-ms-transform':'translateZ(-200px)','transform':'translateZ(-200px)'}).addClass('wr-center');this.$currentItm.parent().attr('image_count',this.itemsCount)},_setItems:function(){this.$items.removeClass('wr-center');this.$currentItm=this.$items.eq(this.current);this.$leftItm=(this.current===0)?this.$items.eq(this.itemsCount-this.$showLength):this.$items.eq(this.current-this.$showLength);this.$rightItm=(this.current===this.itemsCount-this.$showLength)?this.$items.eq(0):this.$items.eq(this.current+this.$showLength);if(!this.support3d&&this.support2d&&this.supportTrans){this.$items.css('z-index',1);this.$currentItm.css('z-index',999)}if(this.itemsCount>3){this.$nextItm=(this.$rightItm.index()===this.itemsCount-this.$showLength)?this.$items.eq(0):this.$rightItm.next();this.$nextItm.css(this._getCompany(this.$marginTop,'outright'));this.$prevItm=(this.$leftItm.index()===0)?this.$items.eq(this.itemsCount-this.$showLength):this.$leftItm.prev();this.$prevItm.css(this._getCompany(this.$marginTop,'outleft'))}},_loadEvents:function(){var _self=this;this.$navPrev.on('click.minamo',function(event){if(_self.options.autoplay){clearTimeout(_self.slideshow);_self.options.autoplay=false}_self._navigate('prev');return false});this.$navNext.on('click.minamo',function(event){if(_self.options.autoplay){clearTimeout(_self.slideshow);_self.options.autoplay=false}_self._navigate('next');return false});this.$wrapper.on('webkitTransitionEnd.minamo transitionend.minamo OTransitionEnd.minamo',function(event){_self.$currentItm.addClass('wr-center');_self.$items.removeClass('wr-transition');_self.isAnim=false})},_getCompany:function(margin_top,position){if(this.support3d&&this.supportTrans){switch(position){case'outleft':return{'-webkit-transform':'translateX(-'+(this.$XOffsetHide+150)+'px) translateZ(-300px)','-moz-transform':'translateX(-'+(this.$XOffsetHide+150)+'px) translateZ(-300px)','-o-transform':'translateX(-'+(this.$XOffsetHide+150)+'px) translateZ(-300px)','-ms-transform':'translateX(-'+(this.$XOffsetHide+150)+'px) translateZ(-300px)','transform':'translateX(-'+(this.$XOffsetHide+150)+'px) translateZ(-300px)','opacity':0,'visibility':'hidden','margin-top':margin_top};break;case'outright':return{'-webkit-transform':'translateX('+(this.$XOffsetShow+150)+'px) translateZ(-300px)','-moz-transform':'translateX('+(this.$XOffsetShow+150)+'px) translateZ(-300px)','-o-transform':'translateX('+(this.$XOffsetShow+150)+'px) translateZ(-300px)','-ms-transform':'translateX('+(this.$XOffsetShow+150)+'px) translateZ(-300px)','transform':'translateX('+(this.$XOffsetShow+150)+'px) translateZ(-300px)','opacity':0,'visibility':'hidden','margin-top':margin_top};break;case'left':return{'-webkit-transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-190px)','-moz-transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-190px)','-o-transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-190px)','-ms-transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-190px)','transform':'translateX(-'+this.$XOffsetHide+'px) translateZ(-190px)','opacity':1,'visibility':'visible','margin-top':margin_top};break;case'right':return{'-webkit-transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','-moz-transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','-o-transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','-ms-transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','transform':'translateX('+this.$XOffsetShow+'px) translateZ(-210px)','opacity':1,'visibility':'visible','margin-top':margin_top};break;case'center':return{'-webkit-transform':'translateZ(-200px)','-moz-transform':'translateZ(-200px)','-o-transform':'translateZ(-200px)','-ms-transform':'translateZ(-200px)','transform':'translateZ(-200px)','opacity':1,'visibility':'visible','margin-top':'-1px'};break}}else if(this.support2d&&this.supportTrans){switch(position){case'outleft':return{'-webkit-transform':'translate(-'+(this.$XOffsetHide+150)+'px) scale(0.7)','-moz-transform':'translate(-'+(this.$XOffsetHide+150)+'px) scale(0.7)','-o-transform':'translate(-'+(this.$XOffsetHide+150)+'px) scale(0.7)','-ms-transform':'translate(-'+(this.$XOffsetHide+150)+'px) scale(0.7)','transform':'translate(-'+(this.$XOffsetHide+150)+'px) scale(0.7)','opacity':0,'visibility':'hidden','margin-top':margin_top};break;case'outright':return{'-webkit-transform':'translate('+(this.$XOffsetShow+150)+'px) scale(0.7)','-moz-transform':'translate('+(this.$XOffsetShow+150)+'px) scale(0.7)','-o-transform':'translate('+(this.$XOffsetShow+150)+'px) scale(0.7)','-ms-transform':'translate('+(this.$XOffsetShow+150)+'px) scale(0.7)','transform':'translate('+(this.$XOffsetShow+150)+'px) scale(0.7)','opacity':0,'visibility':'hidden','margin-top':margin_top};break;case'left':return{'-webkit-transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','-moz-transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','-o-transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','-ms-transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','transform':'translate(-'+this.$XOffsetHide+'px) scale(0.8)','opacity':1,'visibility':'visible','margin-top':margin_top};break;case'right':return{'-webkit-transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','-moz-transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','-o-transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','-ms-transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','transform':'translate('+this.$XOffsetShow+'px) scale(0.8)','opacity':1,'visibility':'visible','margin-top':margin_top};break;case'center':return{'-webkit-transform':'translateZ(-200px)','-moz-transform':'translateZ(-200px)','-o-transform':'translateZ(-200px)','-ms-transform':'translateZ(-200px)','transform':'translateZ(-200px)','opacity':1,'visibility':'visible'};break}}else{switch(position){case'outleft':case'outright':case'left':case'right':return{'opacity':0,'visibility':'hidden'};break;case'center':return{'opacity':1,'visibility':'visible'};break}}},_navigate:function(dir){if(this.supportTrans&&this.isAnim)return false;this.isAnim=true;switch(dir){case'next':this.current=this.$rightItm.index();this.$currentItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'left'));this.$rightItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'center'));if(this.$nextItm){this.$leftItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'outleft'));this.$nextItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'right'))}else{this.$leftItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'right'))}break;case'prev':this.current=this.$leftItm.index();this.$currentItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'right'));this.$leftItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'center'));if(this.$prevItm){this.$rightItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'outright'));this.$prevItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'left'))}else{this.$rightItm.addClass('wr-transition').css(this._getCompany(this.$marginTop,'left'))}break}this._setItems();if(!this.supportTrans)this.$currentItm.addClass('wr-center')},_startSlideshow:function(){var _self=this;this.slideshow=setTimeout(function(){_self._navigate('next');if(_self.options.autoplay){_self._startSlideshow()}},this.options.interval)},destroy:function(){this.$navPrev.off('.minamo');this.$navNext.off('.minamo');this.$wrapper.off('.minamo')}};$.fn.minamo=function(options){if(typeof(options)==='string'){var args=Array.prototype.slice.call(arguments,1);this.each(function(){var instance=$.data(this,'minamo');if(!instance){console.error("初始化失败;"+"调用'"+options+"'方法失败!");return}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){console.error("未定义的方法:'"+options+"';");return}instance[options].apply(instance,args)})}else{this.each(function(){var instance=$.data(this,'minamo');if(!instance){$.data(this,'minamo',new $.Minamo(options,this))}})}return this}})(jQuery);